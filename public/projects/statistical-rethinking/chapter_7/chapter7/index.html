<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
    
        
            <meta name="twitter:card" content="summary"/>
        
    



<meta name="twitter:title" content=""/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@corrieaar"/>



  	<meta property="og:title" content=" &middot; Samples of Thoughts" />
  	<meta property="og:site_name" content="Samples of Thoughts" />
  	<meta property="og:url" content="/projects/statistical-rethinking/chapter_7/chapter7/" />

    
        
            <meta property="og:image" content="/images/tea_with_books.jpg"/>
        
    
    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="0001-01-01T00:00:00Z" />

    
    

    <title> &middot; Samples of Thoughts</title>

    
    <meta name="description" content="Interactions Corrie August 14, 2018
7.1 Building an interaction library(rethinking) data(rugged) d &amp;lt;- rugged  How does terrain ruggedness influence the GDP?
" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    
    
    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/googlecode.min.css' rel='stylesheet' type='text/css' />



  
     
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Samples of Thoughts" />
      
      
    
    <meta name="generator" content="Hugo 0.55.5" />

    <link rel="canonical" href="/projects/statistical-rethinking/chapter_7/chapter7/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null 
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "url":  null ,
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "",
    "name": "",
    "wordCount":  3433 ,
    "timeRequired": "PT17M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "/projects/statistical-rethinking/chapter_7/chapter7/",
    "datePublished": "0001-01-01T00:00Z",
    "dateModified": "0001-01-01T00:00Z",
    
    
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/projects/statistical-rethinking/chapter_7/chapter7/"
    }
}
    </script>
    


    

    
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-140745376-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


    
    
    




<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#40485A",
          "text": "#ffffff"
        },
        "button": {
          "background": "#5B5A68",
          "text": "#ffffff"
        }
      },
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on my website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/projects">Projects</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/talks">Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/about">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Home</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">



      <ul>
        
			<li> <a class="blog-logo" href="/">Home</a> </li>
			  
			<li> <a class="blog-logo" href="/about">About</a> </li>
			  
			<li> <a class="blog-logo" href="/talks">Talks</a> </li>
			  
			<li> <a class="blog-logo" href="/projects">Projects</a> </li>
			  

            
              <a class="menu-button icon-feed" href="">&nbsp;&nbsp;Subscribe</a>
            
            
      
       </ul>
    </nav>
    
     <div class="vertical">
        <div class="main-header-content inner">
            


    <a class="bloglogo" href="https://github.com/corriebar" target="_blank">
    <span class="icon-github" style="color:white;font-size:2em"></span>
    </a>
&nbsp;









    <a class="bloglogo" href="https://twitter.com/corrieaar" target="_blank">
        <span class="icon-twitter" style="color:white;font-size:2em"></span>
    </a>
&nbsp;














            <h1 class="page-title">Samples of Thoughts</h1>
            <h2 class="page-description">about data, statistics  and everything in between</h2>
        </div>
    </div>  
    


</header>



<main class="content" role="main">




  <article class="post projects">

    <header class="post-header">
        <h1 class="post-title"></h1>
        <small></small>

        <section class="post-meta">
        
            <p class="post-reading post-line">
            <span>Estimated reading time: 17 min</span>
            </p>
        
        
        
         
        </section>
    </header>

    <section class="post-content">
      

<h1 id="interactions">Interactions</h1>

<p>Corrie
August 14, 2018</p>

<h2 id="7-1-building-an-interaction">7.1 Building an interaction</h2>

<pre><code class="language-r">library(rethinking)
data(rugged)
d &lt;- rugged
</code></pre>

<p>How does terrain ruggedness influence the GDP?</p>

<pre><code class="language-r"># make log version of outcome
d$log_gdp &lt;- log(d$rgdppc_2000)

dd &lt;- d[ complete.cases(d$rgdppc_2000), ]

# split into Africa andnot-Africa
d.A1 &lt;- dd[ dd$cont_africa == 1, ]
d.A0 &lt;- dd[ dd$cont_africa == 0, ]
</code></pre>

<p>Make two model: one for Africa, one for non-Africa:</p>

<pre><code class="language-r"># Africa
m7.1 &lt;- map(
  alist(
    log_gdp ~ dnorm( mu, sigma) ,
    mu &lt;- a + bR*rugged ,
    a ~ dnorm(8, 100),
    bR ~ dnorm( 0, 1 ),
    sigma ~ dunif( 0, 10 )
  ), data=d.A1
)

# non-Africa
m7.2 &lt;- map(
  alist(
    log_gdp ~ dnorm( mu, sigma ),
    mu &lt;- a + bR*rugged ,
    a ~ dnorm( 8, 100),
    bR ~ dnorm( 0, 1),
    sigma ~ dunif( 0, 10 )
  ), data=d.A0
)
</code></pre>

<p>Make some plots:</p>

<pre><code class="language-r">rug.seq &lt;- seq(from=-1, to=8, length.out = 30)
africa.mu &lt;- link( m7.1, data=data.frame(rugged=rug.seq) )
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">africa.mu.mean &lt;- apply(africa.mu, 2, mean)
africa.mu.PI &lt;- apply(africa.mu, 2, PI)

non.africa.mu &lt;- link( m7.2, data=data.frame(rugged=rug.seq))
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">non.africa.mu.mean &lt;- apply(non.africa.mu, 2, mean)
non.africa.mu.PI &lt;- apply(non.africa.mu, 2, PI)

par(mfrow=c(1,2))
plot( log_gdp ~ rugged, data=d.A1, col=&quot;steelblue&quot;)
lines(rug.seq, africa.mu.mean)
shade(africa.mu.PI, rug.seq)
mtext(&quot;Africa&quot;)

plot( log_gdp ~ rugged, data=d.A0, col=&quot;black&quot;)
lines(rug.seq, non.africa.mu.mean)
shade(non.africa.mu.PI, rug.seq)
mtext(&quot;not Africa&quot;)
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-4-1.png" alt="" /></p>

<p>Ruggedness seems to have different influence for countries outside and inside Africa, the slope is actually reversed! How can we capture the reversed slopes in a single model using all data?</p>

<p>A simple regression on all the data:</p>

<pre><code class="language-r">m7.3 &lt;- map(
  alist(
    log_gdp ~ dnorm( mu, sigma),
    mu &lt;- a + bR*rugged,
    a ~ dnorm( 8, 100),
    bR ~ dnorm(0, 1) ,
    sigma ~ dunif( 0, 10)
  ), data=dd
)
</code></pre>

<p>A regression with a dummy variable for African nations:</p>

<pre><code class="language-r">m7.4 &lt;- map(
  alist(
    log_gdp ~ dnorm( mu, sigma ),
    mu &lt;- a + bR*rugged + bA*cont_africa,
    a ~ dnorm( 8, 100),
    bR ~dnorm( 0, 1),
    bA ~ dnorm( 0, 1),
    sigma ~ dunif(0, 19)
  ), data=dd
)
</code></pre>

<p>Compare the two models:</p>

<pre><code class="language-r">compare( m7.3, m7.4)
</code></pre>

<pre><code>##       WAIC pWAIC dWAIC weight    SE   dSE
## m7.4 476.9   4.7   0.0      1 15.35    NA
## m7.3 539.8   2.8  62.9      0 13.35 15.12
</code></pre>

<pre><code class="language-r">plot( compare( m7.3, m7.4 ))
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-8-1.png" alt="" /></p>

<p>The model with the dummy-variable does perform better than without. Let&rsquo;s plot the dummy-variable model.</p>

<pre><code class="language-r"># mu, fixing cont_africa=0
mu.NotAfrica &lt;- link( m7.4, data=data.frame(rugged=rug.seq, cont_africa=0 ) )
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">mu.NotAfrica.mean &lt;- apply(mu.NotAfrica, 2, mean )
mu.NotAfrica.PI &lt;- apply(mu.NotAfrica, 2, PI)

# mu, fixing cont_africa=1
mu.Africa &lt;- link( m7.4, data=data.frame(rugged=rug.seq, cont_africa=1 ) )
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">mu.Africa.mean &lt;- apply( mu.Africa, 2, mean )
mu.Africa.PI &lt;- apply( mu.Africa, 2, PI )

plot( log_gdp ~ rugged, data=d.A1, col=&quot;steelblue&quot;, 
      xlab=&quot;Terrain Ruggedness Index&quot;,
      ylim= range(dd$log_gdp))
points( log_gdp ~ rugged, data=d.A0, col=&quot;black&quot;)

lines(rug.seq, mu.Africa.mean, col=&quot;steelblue&quot;)
shade(mu.Africa.PI, rug.seq, col=col.alpha(&quot;steelblue&quot;))
text(4, 6.8, &quot;Africa&quot;, col=&quot;steelblue&quot;)

lines(rug.seq, mu.NotAfrica.mean, col=&quot;black&quot;)
shade(mu.NotAfrica.PI, rug.seq, col=col.alpha(&quot;black&quot;))
text(4.5, 9.25, &quot;not Africa&quot;)
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-9-1.png" alt="" /></p>

<p>The dummy-variable has only moved the intercept.</p>

<h3 id="adding-an-interaction">Adding an interaction</h3>

<pre><code class="language-r">m7.5 &lt;- map(
  alist(
    log_gdp ~ dnorm(mu, sigma),
    mu &lt;- a + gamma*rugged + bA*cont_africa,
    gamma &lt;-bR + bAR*cont_africa,
    a ~ dnorm( 8, 100),
    bA ~ dnorm(0, 1),
    bR ~ dnorm(0, 1),
    bAR ~ dnorm( 0, 1),
    sigma ~ dunif( 0, 10)
  ), data=dd
)

compare( m7.3, m7.4, m7.5 )
</code></pre>

<pre><code>##       WAIC pWAIC dWAIC weight    SE   dSE
## m7.5 469.5   5.3   0.0   0.97 15.02    NA
## m7.4 476.4   4.4   6.9   0.03 15.34  6.22
## m7.3 539.6   2.7  70.1   0.00 13.29 15.10
</code></pre>

<pre><code class="language-r">plot( compare( m7.3, m7.4, m7.5))
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-11-1.png" alt="" /></p>

<p>The interaction model performs better than the other two, though it only performs slightly better than the dummy variable: Since there are few countries in Africa, the data are sparse.</p>

<h3 id="plotting-interactions">Plotting interactions</h3>

<pre><code class="language-r">mu.Africa &lt;- link( m7.5, data=data.frame(cont_africa=1, rugged=rug.seq))
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">mu.Africa.mean &lt;- apply(mu.Africa, 2, mean)
mu.Africa.PI &lt;- apply(mu.Africa, 2, PI)

mu.NotAfrica &lt;- link( m7.5, data=data.frame(cont_africa=0, rugged=rug.seq))
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">mu.NotAfrica.mean &lt;- apply(mu.NotAfrica, 2, mean)
mu.NotAfrica.PI &lt;- apply(mu.NotAfrica, 2, PI )

par(mfrow=c(1,2))
plot( log_gdp ~ rugged, data=d.A1,
      col=&quot;steelblue&quot;, ylab=&quot;log GDP year 2000&quot;,
      xlab=&quot;Terrain Ruggedness Index&quot;)
mtext(&quot;African nations&quot;)
lines(rug.seq, mu.Africa.mean, col=&quot;steelblue&quot;)
shade( mu.Africa.PI, rug.seq, col=col.alpha(&quot;steelblue&quot;))

plot( log_gdp ~ rugged, data=d.A0,
      col=&quot;black&quot;, ylab=&quot;log GDP year 2000&quot;,
      xlab=&quot;Terrain Rugggedness Index&quot;)
mtext( &quot;Non-African nations&quot;, 3)
lines( rug.seq, mu.NotAfrica.mean )
shade( mu.NotAfrica.PI, rug.seq )
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-12-1.png" alt="" /></p>

<p>The slope reverses! We can also overlap the plots:</p>

<pre><code class="language-r">plot( log_gdp ~ rugged, data=d.A1, col=&quot;steelblue&quot;, 
      xlab=&quot;Terrain Ruggedness Index&quot;,
      ylim=range(dd$log_gdp))
points( log_gdp ~ rugged, data=d.A0, col=&quot;black&quot;)

lines(rug.seq, mu.Africa.mean, col=&quot;steelblue&quot;)
shade( mu.Africa.PI, rug.seq, col=col.alpha(&quot;steelblue&quot;))
text(4, 6.8, &quot;Africa&quot;, col=&quot;steelblue&quot;)

lines( rug.seq, mu.NotAfrica.mean )
shade( mu.NotAfrica.PI, rug.seq )
text(4.5, 9.25, &quot;not Africa&quot;)
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-13-1.png" alt="" /></p>

<pre><code class="language-r">plot( precis(m7.5) )
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-14-1.png" alt="" /></p>

<p>Gamma wasn&rsquo;t estimated, we have to compute it ourselves.</p>

<pre><code class="language-r">post &lt;- extract.samples( m7.5 )
gamma.Africa &lt;- post$bR + post$bAR*1
gamma.notAfrica &lt;- post$bR + post$bAR*0

mean( gamma.Africa )
</code></pre>

<pre><code>## [1] 0.1631535
</code></pre>

<pre><code class="language-r">mean( gamma.notAfrica )
</code></pre>

<pre><code>## [1] -0.1843177
</code></pre>

<p>How do the distributions compare?</p>

<pre><code class="language-r">dens( gamma.Africa, xlim=c(-0.5, 0.6), ylim=c(0, 5.5),
      xlab=&quot;gamma&quot;, col=&quot;steelblue&quot; )
dens( gamma.notAfrica, add=TRUE )
legend(&quot;topright&quot;, col=c(&quot;black&quot;, &quot;steelblue&quot;), bty=&quot;n&quot;, 
       legend=c(&quot;not Africa&quot;, &quot;Africa&quot;), lty=c(1,1))
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-17-1.png" alt="" /></p>

<pre><code class="language-r">diff &lt;- gamma.Africa - gamma.notAfrica
sum( diff &lt; 0 ) / length( diff )
</code></pre>

<pre><code>## [1] 0.0031
</code></pre>

<p>So there is a very low probability that the African slope is less than the Non-African slope.</p>

<h2 id="7-2-symmetry-of-the-linear-interaction">7.2 Symmetry of the linear interaction</h2>

<p>The above interaction can be interpreted in two ways: (1) How much does the influence of ruggedness (on GDP) depend upon whether the nation is in Africa? (2) How much does the influence of being in Africa (on GDP) depend upon ruggedness?</p>

<p>Above, we plotted the first interpretation, which probably seems more natural for most. Let&rsquo;s plot the other one:</p>

<pre><code class="language-r">q.rugged &lt;- range(dd$rugged)

mu.ruggedlo &lt;- link( m7.5, 
                     data=data.frame(rugged=q.rugged[1], cont_africa=0:1) )
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">mu.ruggedlo.mean &lt;- apply(mu.ruggedlo, 2, mean)
mu.ruggedlo.PI &lt;- apply(mu.ruggedlo, 2, PI)

mu.ruggedhi &lt;- link( m7.5,
                     data=data.frame(rugged=q.rugged[2], cont_africa=0:1 ) )
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r">mu.ruggedhi.mean &lt;- apply(mu.ruggedhi, 2, mean )
mu.ruggedhi.PI &lt;- apply(mu.ruggedhi, 2, PI)

# plot everything
med.r &lt;- median(dd$rugged)
ox &lt;- ifelse(dd$rugged &gt; med.r, 0.05, -0.05 )

plot( dd$cont_africa + ox, dd$log_gdp, 
      col=ifelse(dd$rugged &gt; med.r, &quot;steelblue&quot;, &quot;black&quot;),
      xlim = c(-0.25, 1.25), xaxt=&quot;n&quot;, 
      ylab =&quot;log GDP year 2000&quot;,
      xlab = &quot;Continent&quot;)

axis(1, at=c(0, 1), labels=c(&quot;other&quot;, &quot;Africa&quot;))
lines(0:1, mu.ruggedlo.mean, lty=2)
text(0.35, 9.4, &quot;Low ruggedness&quot;, col=&quot;black&quot;)

shade(mu.ruggedlo.PI, 0:1 )
lines(0:1, mu.ruggedhi.mean, col=&quot;steelblue&quot;)
shade(mu.ruggedhi.PI, 0:1, col=col.alpha(&quot;steelblue&quot;))
text(0.35, 7.3, &quot;High ruggedness&quot;, col=&quot;steelblue&quot;)
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-19-1.png" alt="" /></p>

<p>Blue points are nations with above-median ruggedness. Black points are below the median. The dashed black line is the relationship between continent and log-GDP for an imaginary nation with minimum observed ruggedness (0.003). The blue line is an imaginary nation with maximum observed ruggedness (6.2).</p>

<p>That is, if we have a nation with low ruggedness and we &ldquo;move&rdquo; it to Africa, it&rsquo;s GDP goes down, whereas a nation with high ruggedness would see its GDP increase.</p>

<h2 id="7-3-continuous-interactions">7.3 Continuous interactions</h2>

<pre><code class="language-r">data(tulips)
d &lt;- tulips
str(d)
</code></pre>

<pre><code>## 'data.frame':    27 obs. of  4 variables:
##  $ bed   : Factor w/ 3 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;: 1 1 1 1 1 1 1 1 1 2 ...
##  $ water : int  1 1 1 2 2 2 3 3 3 1 ...
##  $ shade : int  1 2 3 1 2 3 1 2 3 1 ...
##  $ blooms: num  0 0 111 183.5 59.2 ...
</code></pre>

<p>Both water and light help plants grow and produce blooms, so we can model this as an interaction. The difficulty for continuous interactions is how to interpret them.</p>

<p>Let&rsquo;s first implement two models, one with and one without interaction. This time, we use very flat priors.</p>

<pre><code class="language-r">m7.6 &lt;- map(
  alist(
    blooms ~ dnorm(mu, sigma),
    mu &lt;- a + bW*water + bS*shade,
    a ~ dnorm( 0, 100),
    bW ~ dnorm( 0, 100),
    bS ~ dnorm( 0, 100),
    sigma ~ dunif( 0, 100)
  ), data=d
)
</code></pre>

<pre><code>## Error in map(alist(blooms ~ dnorm(mu, sigma), mu &lt;- a + bW * water + bS * : non-finite finite-difference value [4]
## Start values for parameters may be too far from MAP.
## Try better priors or use explicit start values.
## If you sampled random start values, just trying again may work.
## Start values used in this attempt:
## a = -37.485530747013
## bW = -214.785695572581
## bS = 77.407180048364
## sigma = 19.8480702470988
</code></pre>

<pre><code class="language-r">m7.7 &lt;- map(
  alist(
    blooms ~ dnorm( mu, sigma),
    mu &lt;- a + bW*water + bS*shade + bWS*water*shade,
    a ~ dnorm(0, 100),
    bW ~ dnorm( 0, 100),
    bS ~ dnorm( 0, 100),
    bWS ~ dnorm( 0, 100),
    sigma ~ dunif( 0, 100)
  ), data=d
)
</code></pre>

<pre><code>## Caution, model may not have converged.

## Code 1: Maximum iterations reached.
</code></pre>

<p>Fitting this code very likely produces errors: The flat priors make it hard for the optimizer to find good start values that converge. We can fix this problem different ways:</p>

<ul>
<li>use another optimizer</li>
<li>search longer, that is raise the maximum iterations</li>
<li>rescale the data to make it easier to find the right values</li>
</ul>

<p>We first try the first two options:</p>

<pre><code class="language-r">m7.6 &lt;- map(
  alist(
    blooms ~ dnorm(mu, sigma),
    mu &lt;- a + bW*water + bS*shade,
    a ~ dnorm( 0, 100),
    bW ~ dnorm( 0, 100),
    bS ~ dnorm( 0, 100),
    sigma ~ dunif( 0, 100)
  ), 
  data=d,
  method=&quot;Nelder-Mead&quot;,
  control=list(maxit=1e4)
)

m7.7 &lt;- map(
  alist(
    blooms ~ dnorm( mu, sigma),
    mu &lt;- a + bW*water + bS*shade + bWS*water*shade,
    a ~ dnorm(0, 100),
    bW ~ dnorm( 0, 100),
    bS ~ dnorm( 0, 100),
    bWS ~ dnorm( 0, 100),
    sigma ~ dunif( 0, 100)
  ), 
  data=d,
  method=&quot;Nelder-Mead&quot;,
  control=list(maxit=1e4)
)
</code></pre>

<p>No more warnings this time.</p>

<pre><code class="language-r">coeftab(m7.6, m7.7)
</code></pre>

<pre><code>##       m7.6    m7.7   
## a       53.48   10.79
## bW      76.36  109.93
## bS     -38.93   -4.52
## sigma   57.39   51.70
## bWS        NA  -22.33
## nobs       27      27
</code></pre>

<pre><code class="language-r">plot( coeftab( m7.6, m7.7 ) )
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-24-1.png" alt="" /></p>

<p>The estimates are all over the place&hellip; The intercept changes from positive to negative in the second model. In the first model, both the water and shade coefficient are as expected: more water, more blooms and more shade less blooms. For shade, the influence actually becomes positive in the second model. The estimates are not that easy to understand and shouldn&rsquo;t be taken at face value.</p>

<pre><code class="language-r">compare( m7.6, m7.7 )
</code></pre>

<pre><code>##       WAIC pWAIC dWAIC weight   SE  dSE
## m7.7 301.4   6.4   0.0   0.93 9.31   NA
## m7.6 306.6   5.7   5.2   0.07 9.24 3.71
</code></pre>

<p>Pretty much all weight is on the second model with interaction term, so it seems to be a better model than without interaction term.</p>

<h3 id="center-and-re-estimate">Center and re-estimate</h3>

<p>Now, let&rsquo;s center the variables instead.</p>

<pre><code class="language-r">d$shade.c &lt;- d$shade - mean(d$shade)
d$water.c &lt;- d$water - mean(d$water)
</code></pre>

<p>Run the models again:</p>

<pre><code class="language-r">m7.8 &lt;- map(
  alist(
    blooms ~ dnorm( mu, sigma),
    mu &lt;- a + bW*water.c + bS*shade.c ,
    a ~ dnorm( 0, 100),
    bW ~ dnorm( 0, 100),
    bS ~ dnorm( 0, 100),
    sigma ~ dunif( 0, 100)
  ), 
  data=d,
  start=list(a=mean(d$blooms), bW=0, bS=0, sigma=sd(d$blooms))
)
m7.9 &lt;- map(
  alist(
    blooms ~ dnorm( mu, sigma),
    mu &lt;- a + bW*water.c + bS*shade.c + bWS*water.c*shade.c,
    a ~ dnorm(0, 100),
    bW ~ dnorm( 0, 100),
    bS ~ dnorm( 0, 100),
    bWS ~ dnorm( 0, 100),
    sigma ~ dunif( 0, 100)
  ), 
  data=d,
  start=list(a=mean(d$blooms), bW=0, bS=0, bWS=0,
             sigma=sd(d$blooms))
)
coeftab( m7.8, m7.9)
</code></pre>

<pre><code>##       m7.8    m7.9   
## a      127.44  128.05
## bW      74.43   74.95
## bS     -40.85  -41.13
## sigma   57.37   45.23
## bWS        NA  -51.83
## nobs       27      27
</code></pre>

<pre><code class="language-r">plot( coeftab( m7.8, m7.9 ))
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-28-1.png" alt="" /></p>

<p>The estimates for both models look more reasonable: The intercept for both models is the same, it now corresponds to the average bloom. The influence of shade is also negative in both models now.</p>

<pre><code class="language-r">mean(d$bloom)
</code></pre>

<pre><code>## [1] 128.9937
</code></pre>

<p>Just the estimates of the interaction model:</p>

<pre><code class="language-r">precis( m7.9 )
</code></pre>

<pre><code>##         Mean StdDev   5.5%  94.5%
## a     128.05   8.68 114.19 141.92
## bW     74.95  10.60  58.00  91.89
## bS    -41.13  10.60 -58.08 -24.19
## bWS   -51.83  12.95 -72.53 -31.14
## sigma  45.23   6.15  35.39  55.07
</code></pre>

<h3 id="plot-continuous-interactions">Plot continuous interactions</h3>

<p>Let&rsquo;s plot the predictions. We make a plot showing the predictions for different values of water to get a feeling of the interaction effect.</p>

<pre><code class="language-r">par(mfrow=c(2,3))

shade.seq &lt;- -1:1
# plot for model m7.8
for ( w in -1:1 ){
  dt &lt;- d[d$water.c==w, ]
  plot(blooms ~ shade.c, data=dt, col=&quot;steelblue&quot;,
       main=paste(&quot;water.c = &quot;, w), xaxp=c(-1,1,2),
       ylim=c(0, 362), xlab=&quot;shade (centered)&quot;)
  mu &lt;- link( m7.8, data=data.frame(water.c=w, shade.c=shade.seq ) )
  mu.mean &lt;- apply(mu, 2, mean)
  mu.PI &lt;- apply( mu, 2, PI)
  lines( shade.seq, mu.mean )
  lines( shade.seq, mu.PI[1,], lty=2 )
  lines( shade.seq, mu.PI[2,], lty=2)
}
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]

## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]

## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r"># plot for model m7.9
for ( w in -1:1 ){
  dt &lt;- d[d$water.c==w, ]
  plot(blooms ~ shade.c, data=dt, col=&quot;steelblue&quot;,
       main=paste(&quot;water.c = &quot;, w), xaxp=c(-1,1,2),
       ylim=c(0, 362), xlab=&quot;shade (centered)&quot;)
  mu &lt;- link( m7.9, data=data.frame(water.c=w, shade.c=shade.seq ) )
  mu.mean &lt;- apply(mu, 2, mean)
  mu.PI &lt;- apply( mu, 2, PI)
  lines( shade.seq, mu.mean )
  lines( shade.seq, mu.PI[1,], lty=2 )
  lines( shade.seq, mu.PI[2,], lty=2)
}
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]

## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-31-1.png" alt="" /></p>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<p>In the top row, the model without the interaction, the slope for shade does not change, only the intercept. In the bottom row, the influence of shade changes, depending on how much water there is. If there is little water, the plant can&rsquo;t grow well, so no shade or a lot of shade doesn&rsquo;t change the bloom much. Whereas, if we have a more water, shade has a big difference, noticeably in the steep slope. In all plots, the blue points are the data points that had the corresponding water value.</p>

<p>We can also visualize this the other way round:</p>

<pre><code class="language-r">par(mfrow=c(2,3))

water.seq &lt;- -1:1
# plot for model m7.8
for ( s in -1:1 ){
  dt &lt;- d[d$shade.c==s, ]
  plot(blooms ~ water.c, data=dt, col=&quot;steelblue&quot;,
       main=paste(&quot;shade.c = &quot;, s), xaxp=c(-1,1,2),
       ylim=c(0, 362), xlab=&quot;water (centered)&quot;)
  mu &lt;- link( m7.8, data=data.frame(water.c=water.seq, shade.c=s ) )
  mu.mean &lt;- apply(mu, 2, mean)
  mu.PI &lt;- apply( mu, 2, PI)
  lines( shade.seq, mu.mean )
  lines( shade.seq, mu.PI[1,], lty=2 )
  lines( shade.seq, mu.PI[2,], lty=2)
}
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]

## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]

## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<pre><code class="language-r"># plot for model m7.9
for ( s in -1:1 ){
  dt &lt;- d[d$shade.c==s, ]
  plot(blooms ~ water.c, data=dt, col=&quot;steelblue&quot;,
       main=paste(&quot;shade.c = &quot;, s), xaxp=c(-1,1,2),
       ylim=c(0, 362), xlab=&quot;water (centered)&quot;)
  mu &lt;- link( m7.9, data=data.frame(water.c=water.seq, shade.c=s ) )
  mu.mean &lt;- apply(mu, 2, mean)
  mu.PI &lt;- apply( mu, 2, PI)
  lines( shade.seq, mu.mean )
  lines( shade.seq, mu.PI[1,], lty=2 )
  lines( shade.seq, mu.PI[2,], lty=2)
}
</code></pre>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]

## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<p><img src="chapter7_files/figure-markdown_github/unnamed-chunk-32-1.png" alt="" /></p>

<pre><code>## [ 100 / 1000 ]
[ 200 / 1000 ]
[ 300 / 1000 ]
[ 400 / 1000 ]
[ 500 / 1000 ]
[ 600 / 1000 ]
[ 700 / 1000 ]
[ 800 / 1000 ]
[ 900 / 1000 ]
[ 1000 / 1000 ]
</code></pre>

<h2 id="7-4-interactions-in-design-formulas">7.4 Interactions in design formulas</h2>

<pre><code class="language-r">m7.x &lt;- lm( y ~ x + z + x*z, data=d)
</code></pre>

<p>Same model:</p>

<pre><code class="language-r">m7.x &lt;- lm( y ~ x*z, data=d)
</code></pre>

<p>Fit a model with interaction term but without direct effect:</p>

<pre><code class="language-r">m7.x &lt;- lm( y ~ x + x*z - z, data=d)
</code></pre>

<p>Run a model with interaction term and all lower-order interactions:</p>

<pre><code class="language-r">m7.x &lt;- lm( y ~ x*z*w, data=d)
</code></pre>

<p>corresponds to</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0Ay_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu_i%2C%20%5Csigma%29%20%5C%5C%0A%5Cmu_i%20%26%3D%20%5Calpha%20%2B%20%5Cbeta_x%20x_i%20%2B%20%5Cbeta_z%20z_i%20%2B%20%5Cbeta_w%20w_i%20%2B%20%5Cbeta_%7Bxz%7D%20x_i%20z_i%20%2B%20%5Cbeta_%7Bxw%7D%20x_i%20w_i%20%2B%20%5Cbeta_%7Bzw%7D%20z_i%20w_w%20%2B%20%5Cbeta_%7Bxzw%7D%20x_i%20z_i%20w_i%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
y_i &amp;sim text{Normal}(mu_i, sigma" alt="\\begin{align\*}
y\_i &amp;\\sim \\text{Normal}(\\mu\_i, \\sigma) \\\\
\\mu\_i &amp;= \\alpha + \\beta\_x x\_i + \\beta\_z z\_i + \\beta\_w w\_i + \\beta\_{xz} x\_i z\_i + \\beta\_{xw} x\_i w\_i + \\beta\_{zw} z\_i w\_w + \\beta\_{xzw} x\_i z\_i w\_i
\\end{align\*}" /> <br />
\mu_i &amp;= \alpha + \beta_x x_i + \beta_z z_i + \beta_w w<em>i + \beta</em>{xz} x_i z<em>i + \beta</em>{xw} x_i w<em>i + \beta</em>{zw} z_i w<em>w + \beta</em>{xzw} x_i z_i w_i
\end{align*}&ldquo;)</p>

<p>You can also get direct access to the function used by <code>lm</code> to expand these formulas:</p>

<pre><code class="language-r">x &lt;- z &lt;- w &lt;- 1
colnames( model.matrix(~ x*z*w ))
</code></pre>

<pre><code>## [1] &quot;(Intercept)&quot; &quot;x&quot;           &quot;z&quot;           &quot;w&quot;           &quot;x:z&quot;        
## [6] &quot;x:w&quot;         &quot;z:w&quot;         &quot;x:z:w&quot;
</code></pre>

<p>where <code>:</code> stands for multiplication.</p>

    
    </section>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/projects/statistical-rethinking/chapter_6/chapter6c/">
          <section class="post">
              <h5></h5>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="/projects/statistical-rethinking/chapter_7/chapter7_ex/">
          <section class="post">
              <h5></h5>
          </section>
      </a>
      

</aside>



  <footer class="post-footer">


    









<section class="author">
  <h4><a href="/">Corrie</a></h4>
  
  <p>Read <a href="/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    
    
  </div>
</section>




    
<section class="share">
  <h4>Share this projects</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=&nbsp;-&nbsp;Samples%20of%20Thoughts&amp;url=%2fprojects%2fstatistical-rethinking%2fchapter_7%2fchapter7%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=421');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=%2fprojects%2fstatistical-rethinking%2fchapter_7%2fchapter7%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=551');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-linkedin" style="font-size: 1.4em" href="https://www.linkedin.com/shareArticle?mini=true&title=&url=%2fprojects%2fstatistical-rethinking%2fchapter_7%2fchapter7%2f"
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=571');return false;">
    <span class="hidden">LinkedIn</span>
    </a>

</section>




    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "\/projects\/statistical-rethinking\/chapter_7\/chapter7\/";  
this.page.identifier = "\/projects\/statistical-rethinking\/chapter_7\/chapter7\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://corriebar-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Samples of Thoughts</a> 
        &copy; Corrie Bartelheimer 2020 &middot; </section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>


    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
    </script>
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML">
</script>


    
    
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-140745376-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


    
</body>
</html>

