<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content=""/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@corrieaar"/>



  	<meta property="og:title" content=" &middot; Samples of Thoughts" />
  	<meta property="og:site_name" content="Samples of Thoughts" />
  	<meta property="og:url" content="/projects/statistical-rethinking/chapter_4/chapter4_ex/" />

    
        
            <meta property="og:image" content="/images/tea_with_books.jpg"/>
        
    
    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="0001-01-01T00:00:00Z" />

    
    

    <title> &middot; Samples of Thoughts</title>

    
    <meta name="description" content="Chapter 4 - Exercise Corrie May 21, 2018
Chapter 4 - Exercises These are my solutions to the practice questions of chapter 4, Linear Models, of the book &amp;ldquo;" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    
    
    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/googlecode.min.css' rel='stylesheet' type='text/css' />



  
     
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Samples of Thoughts" />
      
      
    
    <meta name="generator" content="Hugo 0.55.5" />

    <link rel="canonical" href="/projects/statistical-rethinking/chapter_4/chapter4_ex/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null 
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "url":  null ,
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "",
    "name": "",
    "wordCount":  1857 ,
    "timeRequired": "PT9M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "/projects/statistical-rethinking/chapter_4/chapter4_ex/",
    "datePublished": "0001-01-01T00:00Z",
    "dateModified": "0001-01-01T00:00Z",
    
    
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/projects/statistical-rethinking/chapter_4/chapter4_ex/"
    }
}
    </script>
    


    

    
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-140745376-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


    
    
    




<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#40485A",
          "text": "#ffffff"
        },
        "button": {
          "background": "#5B5A68",
          "text": "#ffffff"
        }
      },
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on my website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/projects">Projects</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/talks">Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/about">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Home</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">



      <ul>
        
			<li> <a class="blog-logo" href="/">Home</a> </li>
			  
			<li> <a class="blog-logo" href="/about">About</a> </li>
			  
			<li> <a class="blog-logo" href="/talks">Talks</a> </li>
			  
			<li> <a class="blog-logo" href="/projects">Projects</a> </li>
			  

            
              <a class="menu-button icon-feed" href="">&nbsp;&nbsp;Subscribe</a>
            
            
      
       </ul>
    </nav>
    
     <div class="vertical">
        <div class="main-header-content inner">
            


    <a class="bloglogo" href="https://github.com/corriebar" target="_blank">
    <span class="icon-github" style="color:white;font-size:2em"></span>
    </a>
&nbsp;









    <a class="bloglogo" href="https://twitter.com/corrieaar" target="_blank">
        <span class="icon-twitter" style="color:white;font-size:2em"></span>
    </a>
&nbsp;














            <h1 class="page-title">Samples of Thoughts</h1>
            <h2 class="page-description">about data, statistics  and everything in between</h2>
        </div>
    </div>  
    


</header>



<main class="content" role="main">




  <article class="post projects">

    <header class="post-header">
        <h1 class="post-title"></h1>
        <small></small>

        <section class="post-meta">
        
            <p class="post-reading post-line">
            <span>Estimated reading time: 9 min</span>
            </p>
        
        
        
         
        </section>
    </header>

    <section class="post-content">
      

<h1 id="chapter-4-exercise">Chapter 4 - Exercise</h1>

<p>Corrie
May 21, 2018</p>

<h1 id="chapter-4-exercises">Chapter 4 - Exercises</h1>

<p>These are my solutions to the practice questions of chapter 4, Linear Models, of the book &ldquo;Statistical Rethinking&rdquo; by Richard McElreath.</p>

<h2 id="easy-questions">Easy Questions.</h2>

<p><strong>4E1.</strong> In the model definition below, which line is the likelihood:</p>

<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%2A%7D%0Ay_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu%2C%20%5Csigma%29%20%26%20%26%20%5Ctext%7BThis%20is%20the%20likelihood%7D%5C%5C%0A%5Cmu%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C%2010%29%20%5C%5C%0A%5Csigma%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C10%29%0A%5Cend%7Balign%2A%7D%20 &quot;
begin{align*}
y_i &amp;sim text{Normal}(mu, sigma" alt="
\\begin{align\*}
y\_i &amp;\\sim \\text{Normal}(\\mu, \\sigma) &amp; &amp; \\text{This is the likelihood}\\\\
\\mu &amp;\\sim \\text{Normal}(0, 10) \\\\
\\sigma &amp;\\sim \\text{Normal}(0,10)
\\end{align\*} " /> &amp; &amp; \text{This is the likelihood}<br />
\mu &amp;\sim \text{Normal}(0, 10) <br />
\sigma &amp;\sim \text{Normal}(0,10)
\end{align*} &ldquo;)</p>

<p><strong>4E2.</strong> In the model definition just above, how many parameters are in the posterior distribution?</p>

<p>There are <strong>2</strong> parameters, <img src="https://latex.codecogs.com/png.latex?%5Cmu" alt="\\mu" title="\mu" /> and <img src="https://latex.codecogs.com/png.latex?%5Csigma" alt="\\sigma" title="\sigma" />.</p>

<p><strong>4E3.</strong> Write down the appropriate form of Bayes&rsquo; theorem that includes the proper likelihood and priors.</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0AP%28%5Cmu%2C%20%5Csigma%7C%20y_i%29%20%26%5Cpropto%20%5Ctext%7BLikelihood%20%7D%20%5Ctimes%20%5Ctext%7B%20Prior%20probability%7D%20%5C%5C%0A%5C%5C%0AP%28%5Cmu%2C%20%5Csigma%7C%20y_i%29%20%26%3D%20%5Cfrac%7B%5Cprod_i%20%5Ctext%7BNormal%7D%28y_i%7C%5Cmu%2C%20%5Csigma%29%20%5Ctimes%20%0A%5Ctext%7BNormal%7D%28%5Cmu%7C%200%2C10%29%20%5Ctimes%20%5Ctext%7BNormal%7D%28%5Csigma%7C0%2C10%29%20%7D%0A%7B%5Cint%20%5Cprod_i%20%5Ctext%7BNormal%7D%28y_i%7C%5Cmu%2C%20%5Csigma%29%20%5Ctimes%20%0A%5Ctext%7BNormal%7D%28%5Cmu%7C%200%2C10%29%20%5Ctimes%20%5Ctext%7BNormal%7D%28%5Csigma%7C0%2C10%29%20%5Ctext%7B%20d%7D%5Cmu%5Ctext%7Bd%7D%5Csigma%7D%20%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
P(mu, sigma| y_i" alt="\\begin{align\*}
P(\\mu, \\sigma| y\_i) &amp;\\propto \\text{Likelihood } \\times \\text{ Prior probability} \\\\
\\\\
P(\\mu, \\sigma| y\_i) &amp;= \\frac{\\prod\_i \\text{Normal}(y\_i|\\mu, \\sigma) \\times 
\\text{Normal}(\\mu| 0,10) \\times \\text{Normal}(\\sigma|0,10) }
{\\int \\prod\_i \\text{Normal}(y\_i|\\mu, \\sigma) \\times 
\\text{Normal}(\\mu| 0,10) \\times \\text{Normal}(\\sigma|0,10) \\text{ d}\\mu\\text{d}\\sigma} 
\\end{align\*}" /> &amp;\propto \text{Likelihood } \times \text{ Prior probability} <br />
<br />
P(\mu, \sigma| y_i) &amp;= \frac{\prod_i \text{Normal}(y_i|\mu, \sigma) \times
\text{Normal}(\mu| 0,10) \times \text{Normal}(\sigma|0,10) }
{\int \prod_i \text{Normal}(y_i|\mu, \sigma) \times
\text{Normal}(\mu| 0,10) \times \text{Normal}(\sigma|0,10) \text{ d}\mu\text{d}\sigma}
\end{align*}&ldquo;)</p>

<p>where</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BNormal%7D%28x%7C%5Cmu%2C%20%5Csigma%29%20%3D%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%20%5Csigma%5E2%7D%20%7D%5Cexp%28-%20%5Cfrac%7B%28x-%5Cmu%29%5E2%7D%7B2%5Csigma%5E2%7D%29 &quot;text{Normal}(x|mu, sigma" alt="\\text{Normal}(x|\\mu, \\sigma) = \\frac{1}{\\sqrt{2\\pi \\sigma^2} }\\exp(- \\frac{(x-\\mu)^2}{2\\sigma^2})" /> = \frac{1}{\sqrt{2\pi \sigma^2} }\exp(- \frac{(x-\mu)^2}{2\sigma^2})&ldquo;)</p>

<p>.</p>

<p><strong>4E4.</strong> In the model definition below, which line is the linear model?</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0Ay_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu_i%2C%20%5Csigma%29%20%5C%5C%0A%5Cmu_i%20%26%3D%20%5Calpha%20%2B%20%5Cbeta%20x_i%20%26%20%5Ctext%7BThis%20is%20the%20linear%20model%7D%5C%5C%0A%5Calpha%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C10%29%20%5C%5C%0A%5Cbeta%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C1%29%20%5C%5C%0A%5Csigma%20%26%5Csim%20%5Ctext%7BUniform%7D%280%2C10%29%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
y_i &amp;sim text{Normal}(mu_i, sigma" alt="\\begin{align\*}
y\_i &amp;\\sim \\text{Normal}(\\mu\_i, \\sigma) \\\\
\\mu\_i &amp;= \\alpha + \\beta x\_i &amp; \\text{This is the linear model}\\\\
\\alpha &amp;\\sim \\text{Normal}(0,10) \\\\
\\beta &amp;\\sim \\text{Normal}(0,1) \\\\
\\sigma &amp;\\sim \\text{Uniform}(0,10)
\\end{align\*}" /> <br />
\mu_i &amp;= \alpha + \beta x_i &amp; \text{This is the linear model}<br />
\alpha &amp;\sim \text{Normal}(0,10) <br />
\beta &amp;\sim \text{Normal}(0,1) <br />
\sigma &amp;\sim \text{Uniform}(0,10)
\end{align*}&ldquo;)</p>

<p><strong>4E5.</strong> In the model definition just above, how many parameters are in the posterior distribution?</p>

<p>There are <strong>3</strong> parameters in the posterior distribution, <img src="https://latex.codecogs.com/png.latex?%5Calpha" alt="\\alpha" title="\alpha" />, <img src="https://latex.codecogs.com/png.latex?%5Cbeta" alt="\\beta" title="\beta" />, and <img src="https://latex.codecogs.com/png.latex?%5Csigma" alt="\\sigma" title="\sigma" />.</p>

<h2 id="medium-questions">Medium questions.</h2>

<p><strong>4M1.</strong> For the model definition below, simulate observed heights from the prior (not the posterior).</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0Ay_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu%2C%20%5Csigma%29%20%5C%5C%0A%5Cmu%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C%2010%29%20%5C%5C%0A%5Csigma%20%26%5Csim%20%5Ctext%7BUniform%7D%280%2C10%29%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
y_i &amp;sim text{Normal}(mu, sigma" alt="\\begin{align\*}
y\_i &amp;\\sim \\text{Normal}(\\mu, \\sigma) \\\\
\\mu &amp;\\sim \\text{Normal}(0, 10) \\\\
\\sigma &amp;\\sim \\text{Uniform}(0,10)
\\end{align\*}" /> <br />
\mu &amp;\sim \text{Normal}(0, 10) <br />
\sigma &amp;\sim \text{Uniform}(0,10)
\end{align*}&ldquo;)</p>

<pre><code class="language-r">n &lt;- 10000
mu &lt;- rnorm(n, 0, 10)
sigma &lt;- runif(n, 0, 10)
y_prior &lt;- rnorm(n, mu, sigma)
hist(y_prior)
</code></pre>

<p><img src="chapter4_Ex_files/figure-markdown_github/unnamed-chunk-1-1.png" alt="" /></p>

<p><strong>4M2.</strong> Translate the model just above into a <code>map</code> formula.</p>

<pre><code class="language-r">flist &lt;- alist(
            y ~ dnorm(mu, sigma),
            mu ~ dnorm(0, 10),
            sigma ~ dunif(0,10)
          ) 
</code></pre>

<p><strong>4M3.</strong> Translate the <code>map</code> formula below into a mathematical model definition.</p>

<pre><code class="language-r">flist &lt;- alist(
  y ~ dnorm( mu, sigma ),
  mu &lt;- a + b*x,
  a ~ dnorm( 0, 50 ),
  b ~ dnorm( 0, 10 ),
  sigma ~ dunif( 0, 50 )
)
</code></pre>

<p>The mathematical definition:</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0Ay_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu_i%2C%20%5Csigma%29%20%5C%5C%0A%5Cmu_i%20%26%3D%20%5Calpha%20%2B%20%5Cbeta%20x_i%20%5C%5C%0A%5Calpha%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C50%29%20%5C%5C%0A%5Cbeta%20%26%5Csim%20%20%5Ctext%7BUniform%7D%280%2C10%29%20%5C%5C%0A%5Csigma%20%26%5Csim%20%5Ctext%7BUniform%7D%280%2C50%29%20%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
y_i &amp;sim text{Normal}(mu_i, sigma" alt="\\begin{align\*}
y\_i &amp;\\sim \\text{Normal}(\\mu\_i, \\sigma) \\\\
\\mu\_i &amp;= \\alpha + \\beta x\_i \\\\
\\alpha &amp;\\sim \\text{Normal}(0,50) \\\\
\\beta &amp;\\sim  \\text{Uniform}(0,10) \\\\
\\sigma &amp;\\sim \\text{Uniform}(0,50) 
\\end{align\*}" /> <br />
\mu_i &amp;= \alpha + \beta x_i <br />
\alpha &amp;\sim \text{Normal}(0,50) <br />
\beta &amp;\sim  \text{Uniform}(0,10) <br />
\sigma &amp;\sim \text{Uniform}(0,50)
\end{align*}&ldquo;)</p>

<p><strong>4M4.</strong> A sample of students is measured for height each year for three years. You want to fit a linear regression, using year as a prediction. Write down the mathematical model definition.</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0Ah_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu_i%2C%20%5Csigma%29%20%5C%5C%0A%5Cmu_i%20%26%3D%20%5Calpha%20%2B%20%5Cbeta%20t_i%20%5C%5C%0A%5Calpha%20%26%5Csim%20%5Ctext%7BNormal%7D%28160%2C%2050%29%20%5C%5C%0A%5Cbeta%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C%2010%29%20%5C%5C%0A%5Csigma%20%26%5Csim%20%5Ctext%7BUniform%7D%280%2C%2050%29%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
h_i &amp;sim text{Normal}(mu_i, sigma" alt="\\begin{align\*}
h\_i &amp;\\sim \\text{Normal}(\\mu\_i, \\sigma) \\\\
\\mu\_i &amp;= \\alpha + \\beta t\_i \\\\
\\alpha &amp;\\sim \\text{Normal}(160, 50) \\\\
\\beta &amp;\\sim \\text{Normal}(0, 10) \\\\
\\sigma &amp;\\sim \\text{Uniform}(0, 50)
\\end{align\*}" /> <br />
\mu_i &amp;= \alpha + \beta t_i <br />
\alpha &amp;\sim \text{Normal}(160, 50) <br />
\beta &amp;\sim \text{Normal}(0, 10) <br />
\sigma &amp;\sim \text{Uniform}(0, 50)
\end{align*}&ldquo;)</p>

<p>Here, <img src="https://latex.codecogs.com/png.latex?h_i" alt="h\_i" title="h_i" /> is the height and <img src="https://latex.codecogs.com/png.latex?t_i" alt="t\_i" title="t_i" /> is the year of the <img src="https://latex.codecogs.com/png.latex?i" alt="i" title="i" />th observation. Since <img src="https://latex.codecogs.com/png.latex?%5Calpha" alt="\\alpha" title="\alpha" /> is the average height of a student at year zero, I picked a normal distribution with mean 160 (assuming an average height of 160cm) and standard deviation 50, this is relatively weak, leaving a wide range of possible heights. For <img src="https://latex.codecogs.com/png.latex?%5Cbeta" alt="\\beta" title="\beta" />, I picked a normal distribution with mean 0 and standard deviation 10, meaning on average, a person grows 0cm per year with standard deviation 10cm, since I don&rsquo;t expect many people to grow or shrink more than 20cm per year.</p>

<p><strong>4M5.</strong> Now suppose, the average in the first year was 120cm and that every student got taller each year. I will change my priors as follows:</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0A%5Calpha%20%26%5Csim%20%5Ctext%7BNormal%7D%28120%2C%2050%29%20%5C%5C%0A%5Cbeta%20%26%5Csim%20%5Ctext%7BUniform%7D%280%2C%2020%29%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
alpha &amp;sim text{Normal}(120, 50" alt="\\begin{align\*}
\\alpha &amp;\\sim \\text{Normal}(120, 50) \\\\
\\beta &amp;\\sim \\text{Uniform}(0, 20)
\\end{align\*}" /> <br />
\beta &amp;\sim \text{Uniform}(0, 20)
\end{align*}&ldquo;)</p>

<p>I adjusted the mean for the average height accordingly and changed <img src="https://latex.codecogs.com/png.latex?%5Cbeta" alt="\\beta" title="\beta" /> to a uniform distribution, so that <img src="https://latex.codecogs.com/png.latex?%5Cbeta" alt="\\beta" title="\beta" />, the indicator for growth per year, is greater or equal than zero. I still don&rsquo;t expect people to grow more than 20cm per year.</p>

<p><strong>4M6.</strong> Now suppose, the variance among heights for students of the same age is never more than 64cm. I thus change my priors as follows:</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Csigma%20%5Csim%20%5Ctext%7BUniform%7D%280%2C%2064%29. &quot;sigma sim text{Uniform}(0, 64" alt="\\sigma \\sim \\text{Uniform}(0, 64)." />.&ldquo;)</p>

<h2 id="hard-question">Hard question.</h2>

<p><strong>4H1.</strong> !Kung census data: Provide predicted heights and 89% intervals (either HPDI or PI) for the following weights of individuals.</p>

<pre><code class="language-r">weights &lt;- c(46.95, 43.72, 64.78, 32.59, 54.63)
</code></pre>

<p>For this, we first load the !Kung data from the <code>Howell1</code> data set and set up a model. I will use a linear model with priors as in the model definition given earlier in the chapter.</p>

<pre><code class="language-r">library(rethinking)
data(Howell1)
d &lt;- Howell1
d2 &lt;- d[ d$age &gt;= 18, ]
d2$weight.c &lt;- d2$weight - mean(d2$weight)    # centering the weights

# fit model
model &lt;- map(
  alist(
    height ~ dnorm( mu, sigma) ,
    mu &lt;- a + b*weight.c,   
    a ~ dnorm( 156, 100) ,   # average height with weak prior
    b ~ dnorm( 0, 10),       # fairly uninformative prior
    sigma ~ dunif( 0, 50)
  ), 
  data=d2
)

precis( model)
</code></pre>

<pre><code>##         Mean StdDev   5.5%  94.5%
## a     154.60   0.27 154.17 155.03
## b       0.91   0.04   0.84   0.97
## sigma   5.07   0.19   4.77   5.38
</code></pre>

<p>How to interpret the model: Since we centered the weights such that the mean of <code>weight.c</code> is zero, <code>a</code> corresponds to the average height. The value 0.91 for <code>b</code> means that a person 1kg heavier is expected to be 0.90cm taller. The estimate for <img src="https://latex.codecogs.com/png.latex?%5Csigma" alt="\\sigma" title="\sigma" />, <code>sigma</code> tells us about the width of the distribution of heights around the mean. Let&rsquo;s now use the model to predict the heights for the weight values given above. For this, we simulate heights for each given weight value. We do this by first obtaining a sample from the posterior distribution and then use this sample to draw samples from a Gaussian distribution. Note that we also need to center the given weights now.</p>

<pre><code class="language-r">weights.c &lt;- weights - mean(d2$weight)
post &lt;- extract.samples(model)
sim.height &lt;- sapply( weights.c, function(weight) {
  rnorm(
    n = nrow(post),
    mean = post$a + post$b*weight,
    sd = post$sigma
  )
})

height.PI &lt;- apply(sim.height, 2, PI, prob=0.89)
height.HPDI &lt;- apply(sim.height, 2, HPDI, prob=0.89)
height.mean &lt;- apply(sim.height, 2, mean)

pred_df &lt;- data.frame(&quot;individual&quot;=1:5, &quot;weight&quot;=weights, &quot;exptected_height&quot;=height.mean, 
                      &quot;PI_89_lower&quot;=height.PI[1,], &quot;PI_89_upper&quot;=height.PI[2,])
pred_df
</code></pre>

<pre><code>##   individual weight exptected_height PI_89_lower PI_89_upper
## 1          1  46.95         156.3805    148.3043    164.7225
## 2          2  43.72         153.4712    145.4467    161.4731
## 3          3  64.78         172.5536    164.1396    180.7728
## 4          4  32.59         143.3558    135.4099    151.5933
## 5          5  54.63         163.2698    154.9963    171.4575
</code></pre>

<p><strong>4H2.</strong> Select the rows from the <code>Howell1</code> data with age below 18 years.</p>

<ol>
<li>Fit a linear regression to these data, using <code>map</code>. I will use the same model as above.</li>
</ol>

<pre><code class="language-r">d18 &lt;- d[ d$age &lt; 18, ]
d18$weight.c &lt;- d18$weight - mean(d18$weight)   # centering the data

# fit the model

model18 &lt;- map(
  alist(
    height ~ dnorm( mu, sigma) ,
    mu &lt;- a + b*weight.c ,
    a ~ dnorm( 156, 100) ,
    b ~ dnorm( 0, 10) ,
    sigma ~ dunif(0, 50)
  ),
  data=d18
)
precis(model18)
</code></pre>

<pre><code>##         Mean StdDev   5.5%  94.5%
## a     108.32   0.61 107.35 109.29
## b       2.72   0.07   2.61   2.83
## sigma   8.44   0.43   7.75   9.13
</code></pre>

<p>As above, since we centered the weights, the intercept <code>a</code> corresponds to the average height, which is here 108.3. This is much lower than in the model above (but expected since the individuals in this data set are younger). The slope <code>b</code> is interpreted such that for every 10kg heavier, an individual is expected to be 27cm taller. The standard deviation <code>sigma</code> in this model is higher than in the one above, suggesting a higher uncertainty in the predictions.</p>

<ol>
<li>Plot the raw data and superimpose the MAP regression line and 89% HPDI for the mean and for the predicted height. We first compute the regression line by generating a sequence over the whole range of (centered) weights for which we then sample from the posterior distribution to compute a sample of mu, of which we can then compute the mean and the 89% HPDI. We similarly compute the 89% HPDI for the predicted height (as also done in the question before).</li>
</ol>

<pre><code class="language-r">weight.seq &lt;- seq(from=-15, to=30, length.out = 30)             # generate weights (centered) over the whole range
post &lt;- extract.samples(model18)                                # extract a posterior sample
# compute mu
mu.link &lt;- function(weight.c) post$a + post$b*weight.c           # the function to compute mu, using the sample above
mu &lt;- sapply(weight.seq, mu.link)
mu.mean &lt;- apply(mu, 2, mean)
mu.HPDI &lt;- apply(mu, 2, HPDI, prob=0.89)

# compute predicted height
sim.height &lt;- sapply( weight.seq, function(weight) {
  rnorm(
    n = nrow(post),
    mean = post$a + post$b*weight,
    sd = post$sigma
  )
})

height.HPDI &lt;- apply(sim.height, 2, HPDI, prob=0.89)
height.mean &lt;- apply(sim.height, 2, mean)

# plot everything
plot(height ~ weight.c, data=d18, col=col.alpha(rangi2, 0.9), ylim=c(50, 180))   # the raw data
lines(weight.seq, mu.mean)                                      # the MAP regression line
shade( mu.HPDI, weight.seq)                                     # draw HPDI region around the regression line
shade( height.HPDI, weight.seq)                                 # draw HPDI region for the simulated heights
</code></pre>

<p><img src="chapter4_Ex_files/figure-markdown_github/unnamed-chunk-8-1.png" alt="" /></p>

<ol>
<li>What aspects of the model fit concern you? The linear model doesn&rsquo;t seem to be a very good fit for the data. It performs very poorly for the lower and higher values of weight. One possibility to improve the model could be to use a polynomial model (e.g. of 2nd order) instead.</li>
</ol>

<p><strong>4H3.</strong> A colleague exclaims: &ldquo;Only the <em>logarithm</em> of body weight scales with height!&rdquo; Let&rsquo;s try this out.</p>

<ol>
<li><p>Use the entire <code>Howell1</code> data frame using the following model:</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0Ah_i%20%26%5Csim%20%5Ctext%7BNormal%7D%28%5Cmu_i%2C%20%5Csigma%29%20%5C%5C%0A%5Cmu_i%20%26%3D%20%5Calpha%20%2B%20%5Cbeta%20%5Clog%28w_i%29%20%5C%5C%0A%5Calpha%20%26%5Csim%20%5Ctext%7BNormal%7D%28178%2C%20100%29%20%5C%5C%0A%5Cbeta%20%26%5Csim%20%5Ctext%7BNormal%7D%280%2C%20100%29%20%5C%5C%0A%5Csigma%20%26%5Csim%20%5Ctext%7BUniform%7D%280%2C%2050%29%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
h_i &amp;sim text{Normal}(mu_i, sigma" alt="\\begin{align\*}
h\_i &amp;\\sim \\text{Normal}(\\mu\_i, \\sigma) \\\\
\\mu\_i &amp;= \\alpha + \\beta \\log(w\_i) \\\\
\\alpha &amp;\\sim \\text{Normal}(178, 100) \\\\
\\beta &amp;\\sim \\text{Normal}(0, 100) \\\\
\\sigma &amp;\\sim \\text{Uniform}(0, 50)
\\end{align\*}" /> <br />
\mu_i &amp;= \alpha + \beta \log(w_i) <br />
\alpha &amp;\sim \text{Normal}(178, 100) <br />
\beta &amp;\sim \text{Normal}(0, 100) <br />
\sigma &amp;\sim \text{Uniform}(0, 50)
\end{align*}&ldquo;)</p>

<p>Here the model description in R:</p></li>
</ol>

<pre><code class="language-r">d &lt;- Howell1
# fit the model

model.l &lt;- map(
  alist(
    height ~ dnorm( mu, sigma) ,
    mu &lt;- a + b*log(weight) ,
    a ~ dnorm( 178, 100) ,
    b ~ dnorm( 0, 100) ,                
    sigma ~ dunif(0, 50)
  ),
  data=d
)
precis(model.l)
</code></pre>

<pre><code>##         Mean StdDev   5.5%  94.5%
## a     -23.78   1.34 -25.92 -21.65
## b      47.08   0.38  46.46  47.69
## sigma   5.13   0.16   4.89   5.38
</code></pre>

<p>Interpreting these results is a bit more difficult since we transformed the weights using the logarithm. Furthermore, the data is not centralized as before, so the intercept <code>a</code> corresponds to the average height of someone whose log weight is zero, i.e. whose weight is 1kg. How to interpret the <code>b</code> value? If we raise the weight by one unit, we get the following expression for mu:</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0A%5Cmu%20%26%3D%20%5Calpha%20%2B%20%5Cbeta%20%5Clog%28%5Ctext%7Bweight%7D%20%2B%201%29%20%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
mu &amp;= alpha + beta log(text{weight} + 1" alt="\\begin{align\*}
\\mu &amp;= \\alpha + \\beta \\log(\\text{weight} + 1) 
\\end{align\*}" />
\end{align*}&ldquo;)</p>

<p>Using some rules for logarithms, we get:</p>

<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Balign%2A%7D%0A%5Cmu%20%26%3D%20%5Calpha%20%2B%20%5Cbeta%20%5Clog%28%5Ctext%7Bweight%7D%29%20%2B%20%5Cbeta%20%5Clog%281%20%2B%20%5Cfrac%7B1%7D%7B%5Ctext%7Bweight%7D%7D%29%0A%5Cend%7Balign%2A%7D &quot;begin{align*}
mu &amp;= alpha + beta log(text{weight}" alt="\\begin{align\*}
\\mu &amp;= \\alpha + \\beta \\log(\\text{weight}) + \\beta \\log(1 + \\frac{1}{\\text{weight}})
\\end{align\*}" /> + \beta \log(1 + \frac{1}{\text{weight}})
\end{align*}&ldquo;)</p>

<p>That is, an increase of one unit in the weight variable is associated with an increase of the mean <img src="https://latex.codecogs.com/png.latex?%5Cmu" alt="\\mu" title="\mu" /> of <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20%5Clog%281%20%2B%20%5Cfrac%7B1%7D%7B%5Ctext%7Bweight%7D%7D%29 &quot;beta log(1 + frac{1}{text{weight}}" alt="\\beta \\log(1 + \\frac{1}{\\text{weight}})" />&rdquo;). I personally find that not very intuitive, so let&rsquo;s have a look at some plots as well.</p>

<pre><code class="language-r">weight.seq &lt;- seq(from=2, to=65, length.out = 70)             # generate weights over the whole range
                                                              # min(d$weight) = 4.25, max(d$weight) = 62.99
post &lt;- extract.samples(model.l)                              # extract a posterior sample
# compute mu
mu.link &lt;- function(weight) post$a + post$b*log(weight)       # the function to compute mu, using the sample above
mu &lt;- sapply(weight.seq, mu.link)
mu.mean &lt;- apply(mu, 2, mean)
mu.HPDI &lt;- apply(mu, 2, HPDI, prob=0.89)

# compute predicted height
sim.height &lt;- sapply( weight.seq, function(weight) {
  rnorm(
    n = nrow(post),
    mean = post$a + post$b*log(weight),
    sd = post$sigma
  )
})

height.HPDI &lt;- apply(sim.height, 2, HPDI, prob=0.89)
height.mean &lt;- apply(sim.height, 2, mean)

# the plot
plot(height ~ log(weight), data=d, col=col.alpha(rangi2, 0.6))
lines(log(weight.seq), mu.mean)                                      # the MAP regression line
shade( mu.HPDI, log(weight.seq))                                     # draw HPDI region around the regression line
shade( height.HPDI, log(weight.seq))                                 # draw HPDI region for the simulated heights
</code></pre>

<p><img src="chapter4_Ex_files/figure-markdown_github/unnamed-chunk-10-1.png" alt="" /></p>

<p>Compared to the model above fit to only the children and also compared to the models earlier in the chapter using the full data set with polynomial regression, this model seems to perform quite well on the data.</p>

<ol>
<li>Let&rsquo;s make the same plot without using the logarithmic scale.</li>
</ol>

<pre><code class="language-r">plot(height ~ weight, data=d, col=col.alpha(rangi2, 0.6))
lines(weight.seq, mu.mean)
shade(mu.HPDI, weight.seq)
shade( height.HPDI, weight.seq)
</code></pre>

<p><img src="chapter4_Ex_files/figure-markdown_github/unnamed-chunk-11-1.png" alt="" /></p>

<p>Given the last two plots, I&rsquo;d say the colleague was right: The logarithm of body weight scales very well with height.</p>

    
    </section>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/projects/statistical-rethinking/chapter_3/chapter3_ex/">
          <section class="post">
              <h5></h5>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="/projects/statistical-rethinking/chapter_5/chapter5_ex/">
          <section class="post">
              <h5></h5>
          </section>
      </a>
      

</aside>



  <footer class="post-footer">


    









<section class="author">
  <h4><a href="/">Corrie</a></h4>
  
  <p>Read <a href="/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    
    
  </div>
</section>




    
<section class="share">
  <h4>Share this projects</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=&nbsp;-&nbsp;Samples%20of%20Thoughts&amp;url=%2fprojects%2fstatistical-rethinking%2fchapter_4%2fchapter4_ex%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=421');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=%2fprojects%2fstatistical-rethinking%2fchapter_4%2fchapter4_ex%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=551');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-linkedin" style="font-size: 1.4em" href="https://www.linkedin.com/shareArticle?mini=true&title=&url=%2fprojects%2fstatistical-rethinking%2fchapter_4%2fchapter4_ex%2f"
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=571');return false;">
    <span class="hidden">LinkedIn</span>
    </a>

</section>




    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "\/projects\/statistical-rethinking\/chapter_4\/chapter4_ex\/";  
this.page.identifier = "\/projects\/statistical-rethinking\/chapter_4\/chapter4_ex\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://corriebar-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Samples of Thoughts</a> 
        &copy; Corrie Bartelheimer 2020 &middot; </section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>


    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
    </script>
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML">
</script>


    
    
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-140745376-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


    
</body>
</html>

