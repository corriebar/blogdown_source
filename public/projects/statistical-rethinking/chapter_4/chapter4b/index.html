


<p>library(rethinking)
data(“Howell1”)
d &lt;- Howell1
d2 &lt;- d[ d$age &gt;= 18, ]</p>
<p>plot(height ~ weight, data=d2)
# looks like a nice perfect linear relationship!</p>
<div id="first-linear-model" class="section level1">
<h1>first linear model</h1>
<p>m4.3 &lt;- map(
alist(
height ~ dnorm( mu, sigma),
mu &lt;- a + b*weight ,
a ~ dnorm( 156, 100),
b ~ dnorm( 0, 10),
sigma ~ dunif(0, 50)
) ,
data = d2
)</p>
<p>precis( m4.3, corr=T )
# the intercept a corresponds now to the height for some that weighs 0kg
# not very interpretable</p>
</div>
<div id="same-model-with-centered-weight" class="section level1">
<h1>Same model with centered weight</h1>
<p>d2<span class="math inline">\(weight.c &lt;- d2\)</span>weight - mean(d2$weight )</p>
<p>m4.4 &lt;- map(
alist(
height ~ dnorm( mu, sigma) ,
mu &lt;- a + b*weight.c ,
a ~ dnorm( 156, 100) ,
b ~ dnorm(0, 10) ,
sigma ~ dunif(0, 50)
),
data=d2
)</p>
<p>precis( m4.4, corr=T)
# now the intercept a corresponds to a value of weight.c of zero, which is just the mean
# of weight.c (because it’s centered)</p>
<p>plot( height ~ weight, data=d2)
abline(a=coef(m4.3)[“a”], b=coef(m4.3)[“b”])</p>
<p>post &lt;- extract.samples(m4.3)
head(post)</p>
</div>
<div id="lets-try-out-the-influence-of-adding-more-points-to-the-model" class="section level1">
<h1>lets try out the influence of adding more points to the model</h1>
<p>Ns &lt;- c(10, 50, 150, 352)
par(mfrow=c(2,2))
for (N in Ns){
#N &lt;- 10
dN &lt;- d2[1:N,]
mN &lt;- map(
alist(
height ~ dnorm(mu, sigma) ,
mu &lt;- a + b*weight ,
a ~ dnorm(156, 100) ,
b ~ dnorm(0, 10) ,
sigma ~ dunif(0, 50)
), data=dN
)
# extract 20 samples from the posterior
post &lt;- extract.samples(mN, n=20)</p>
<p># display raw data and sample size
plot(dN<span class="math inline">\(weight, dN\)</span>height, col=rangi2, xlab=“weight”, ylab=“height”,
xlim=range(d2<span class="math inline">\(weight), ylim=range(d2\)</span>height))
mtext(concat(“N =”,N))</p>
<p># plot the lines with transparency
for (i in 1:20)
abline(a=post<span class="math inline">\(a[i], b=post\)</span>b[i], col=col.alpha(“black”, 0.3))
}
par(mfrow=c(1,1))</p>
<p>post &lt;- extract.samples(m4.3)
mu_at_50 &lt;- post<span class="math inline">\(a + post\)</span>b * 50
dens( mu_at_50, col=rangi2, lwd=2, xlab=“mu | weight=50”)
HPDI(mu_at_50, prob=0.89)</p>
</div>
<div id="compute-mu-for-each-weight-observation-in-data" class="section level1">
<h1>compute mu for each weight observation in data</h1>
</div>
<div id="link-computes-the-value-of-each-linear-model-at-each-sample-for-each-case-in-the-data" class="section level1">
<h1>link computes the value of each linear model at each sample for each case in the data</h1>
<p>mu &lt;- link(m4.3)
# each row is a sample from the posterior distribution</p>
</div>
<div id="define-sequence-of-weights-to-compute-predictions" class="section level1">
<h1>define sequence of weights to compute predictions</h1>
</div>
<div id="for-these-values-will-be-on-the-horizontal-axis" class="section level1">
<h1>for these values will be on the horizontal axis</h1>
<p>weight.seq &lt;- seq( from=25, to=70, by=1)</p>
</div>
<div id="use-link-to-compute-mu" class="section level1">
<h1>use link to compute mu</h1>
</div>
<div id="for-each-sample-from-posterior" class="section level1">
<h1>for each sample from posterior</h1>
</div>
<div id="and-for-each-weight-in-weight.seq" class="section level1">
<h1>and for each weight in weight.seq</h1>
<p>mu &lt;- link(m4.3, data=data.frame(weight=weight.seq))
str(mu)</p>
</div>
<div id="plot" class="section level1">
<h1>plot</h1>
<p>plot(height ~ weight, d2, type=“n”)</p>
</div>
<div id="loop-over-samples-and-plot-each-mu-value" class="section level1">
<h1>loop over samples and plot each mu value</h1>
<p>for (i in 1:100)
points(weight.seq, mu[i,], pch=16, col=col.alpha(rangi2, 0.1))</p>
</div>
<div id="summarize-the-distribution-of-mu" class="section level1">
<h1>summarize the distribution of mu</h1>
<p>mu.mean &lt;- apply(mu, 2, mean)
mu.HPDI &lt;- apply(mu, 2, HPDI, prob=0.89)</p>
</div>
<div id="plot-raw-data" class="section level1">
<h1>plot raw data</h1>
<p>plot(height ~ weight, data=d2, col=col.alpha(rangi2, 0.5))</p>
</div>
<div id="plot-the-map-line" class="section level1">
<h1>plot the MAP line</h1>
<p>lines(weight.seq, mu.mean)</p>
</div>
<div id="plot-a-shaded-region-for-89-hpdi" class="section level1">
<h1>plot a shaded region for 89% HPDI</h1>
<p>shade( mu.HPDI, weight.seq)</p>
</div>
<div id="simulate-heights" class="section level1">
<h1>simulate heights</h1>
<p>sim.height &lt;- sim( m4.3, data=list(weight=weight.seq), n=1e4)
str(sim.height)</p>
<p>height.PI &lt;- apply(sim.height, 2, PI, prob=0.89)</p>
<p>par(mfrow=c(1,1))
# plot everything together
plot( height ~ weight, d2, col=col.alpha(rangi2, 0.5))</p>
</div>
<div id="draw-a-map-line" class="section level1">
<h1>draw a MAP line</h1>
<p>lines(weight.seq, mu.mean)</p>
</div>
<div id="draw-hpdi-region-for-line" class="section level1">
<h1>draw HPDI region for line</h1>
<p>shade(mu.HPDI, weight.seq)</p>
</div>
<div id="draw-pi-region-for-simulated-heights" class="section level1">
<h1>draw PI region for simulated heights</h1>
<p>shade(height.PI, weight.seq )</p>
</div>
<div id="plot-different-boundaries" class="section level1">
<h1>plot different boundaries</h1>
<p>bds &lt;- c(0.67, 0.89, 0.95, 0.97)
par(mfrow=c(2,2))
for (b in bds) {
height.PI &lt;- apply(sim.height, 2, PI, prob=b)</p>
<p># plot everything together
plot( height ~ weight, d2, col=col.alpha(rangi2, 0.5), main=b)</p>
<p># draw a MAP line
lines(weight.seq, mu.mean)</p>
<p># draw HPDI region for line
shade(mu.HPDI, weight.seq)</p>
<p># draw PI region for simulated heights
shade(height.PI, weight.seq )
}</p>
</div>
<div id="run-your-own-sim" class="section level1">
<h1>run your own sim</h1>
<p>post &lt;- extract.samples(m4.3)
weight.seq &lt;- 25:70
sim.height &lt;- sapply( weight.seq, function(weight)
rnorm(
n=nrow(post),
mean=post<span class="math inline">\(a + post\)</span>b*weight,
sd=post$sigma
))
height.PI &lt;- apply(sim.height, 2, PI, prob=0.89)</p>
</div>
